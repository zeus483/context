generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SessionStatus {
  DONE
  PARTIAL
  MISSED
  REST
}

enum Intensity {
  LOW
  MEDIUM
  HIGH
}

model User {
  id              String             @id @default(cuid())
  email           String             @unique
  passwordHash    String
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  profile         Profile?
  sessions        WorkoutSession[]
  bodyWeightLogs  BodyWeightLog[]
  progressPhotos  ProgressPhoto[]
  authSessions    UserSession[]
  assignments     WorkoutAssignment[]
}

model UserSession {
  id          String   @id @default(cuid())
  userId      String
  tokenHash   String   @unique
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  lastUsedAt  DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, expiresAt])
}

model Profile {
  id                 String   @id @default(cuid())
  userId             String   @unique
  name               String?
  weightKg           Float
  heightCm           Int
  age                Int
  goal               String
  trainingDays       Int      @default(5)
  availableHours     Int      @default(2)
  beachGoalDate      DateTime
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model WorkoutPlan {
  id          String       @id @default(cuid())
  name        String       @unique
  description String
  isActive    Boolean      @default(true)
  workoutDays WorkoutDay[]
}

model WorkoutDay {
  id              String              @id @default(cuid())
  workoutPlanId   String
  dayNumber       Int
  title           String
  focus           String
  isOptional      Boolean             @default(false)
  cardioDefault   Int
  workoutPlan     WorkoutPlan         @relation(fields: [workoutPlanId], references: [id], onDelete: Cascade)
  dayExercises    DayExercise[]
  sessions        WorkoutSession[]
  assignments     WorkoutAssignment[]

  @@unique([workoutPlanId, dayNumber])
}

model Exercise {
  id              String        @id @default(cuid())
  name            String
  muscleGroup     String
  equipment       String
  imageUrl        String
  instructions    String
  commonMistakes  String
  tips            String
  alternatives    String
  dayExercises    DayExercise[]
  exerciseSets    ExerciseSet[]

  @@unique([name, equipment])
}

model DayExercise {
  id               String     @id @default(cuid())
  workoutDayId     String
  exerciseId       String
  order            Int
  suggestedSets    Int
  suggestedReps    String
  suggestedRestSec Int
  workoutDay       WorkoutDay @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)
  exercise         Exercise   @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  @@unique([workoutDayId, order])
}

model WorkoutAssignment {
  id            String     @id @default(cuid())
  userId        String
  date          DateTime
  workoutDayId  String?
  isRest        Boolean    @default(false)
  movedFromDate DateTime?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutDay    WorkoutDay? @relation(fields: [workoutDayId], references: [id], onDelete: SetNull)

  @@unique([userId, date])
  @@index([userId, date])
}

model WorkoutSession {
  id              String        @id @default(cuid())
  userId          String
  workoutDayId    String
  date            DateTime
  status          SessionStatus @default(PARTIAL)
  notes           String?
  movedFromDate   DateTime?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  workoutDay      WorkoutDay    @relation(fields: [workoutDayId], references: [id], onDelete: Cascade)
  sets            ExerciseSet[]
  cardioEntry     CardioEntry?

  @@unique([userId, date, workoutDayId])
  @@index([userId, date])
}

model ExerciseSet {
  id               String         @id @default(cuid())
  workoutSessionId String
  exerciseId       String
  setNumber        Int
  weightKg         Float?
  reps             Int?
  rir              Int?
  notes            String?
  completed        Boolean        @default(false)
  workoutSession   WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)
  exercise         Exercise       @relation(fields: [exerciseId], references: [id], onDelete: Cascade)

  @@unique([workoutSessionId, exerciseId, setNumber])
  @@index([exerciseId])
}

model CardioEntry {
  id               String         @id @default(cuid())
  workoutSessionId String         @unique
  cardioType       String
  minutes          Int
  intensity        Intensity
  reasonIfZero     String?
  workoutSession   WorkoutSession @relation(fields: [workoutSessionId], references: [id], onDelete: Cascade)
}

model BodyWeightLog {
  id        String   @id @default(cuid())
  userId    String
  date      DateTime
  weightKg  Float
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
  @@index([userId, date])
}

model ProgressPhoto {
  id          String   @id @default(cuid())
  userId      String
  date        DateTime
  imageUrl    String
  privacyNote String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, date])
}
